jQuery(function($){if(typeof lucid_single_quiz_params==="undefined"){return false;}var timer;var htmlTimer=$("#quiz-timer");var questionsInAjax={};var questionsLoadingScreen=$(".questions-loading-screen");var quizStartScreen=$(".start-quiz-screen");var quizCompletedView=$(".quiz-completed");var questionsContainer=$(".questions-container");var questionsWrap=$(".questions");var questions=questionsContainer.find(".questions > li");var questionsReviewScreen=$(".review-screen");var questionsPagination=$(".questions-pagination");var questionsPaginationItems=questionsPagination.find("li");var questionsNav=$(".questions-nav");var currentQuestion;var newQuestionID;var answers;$.fn.initTimer=function(){if(htmlTimer.length>0){timer=new Timer(htmlTimer,false,function(){$.fn.validateAnswer($.fn.completeQuiz);$(".questions-loading-screen i").show();questionsContainer.fadeOut(600,function(){questionsLoadingScreen.fadeIn(600);});},1000);timer.start();}};$.fn.showQuestion=function(){if(typeof currentQuestion!=="undefined"&&currentQuestion.attr("data-id")===newQuestionID){return;}var pattern='[data-id="'+newQuestionID+'"]';questions.hide();questionsPaginationItems.removeClass("current");if(newQuestionID==="review"){questionsNav.hide();if(typeof currentQuestion!=="undefined"){$.fn.updateReviewScreen();}}else{questionsNav.show();}currentQuestion=questionsWrap.find(pattern);currentQuestion.show();questionsPagination.find(pattern).addClass("current");};$.fn.animateQuestionsView=function(callback){questionsContainer.fadeOut(600,function(){callback();questionsContainer.fadeIn(600);});};$.fn.validateAnswer=function(callbackFunc){answers=$.fn.checkAnswer();$.fn.saveAnswer(callbackFunc);};$.fn.checkAnswer=function(){var questionType=currentQuestion.attr("data-type");var pattern;var key;var value;switch(questionType){case"multiple_choice":pattern='input[type="checkbox"]:checked';key="value";break;case"single_choice":pattern='input[type="radio"]:checked';key="value";break;case"open":pattern="textarea";key="open";break;default:pattern="input";key="open";break;}var found=currentQuestion.find(pattern);var questionWarningOption=$('<p class="lucid-warning"><i class="fa fa-exclamation"></i>Please, select an option before moving on.</p>');var questionWarningOpen=$('<p class="lucid-warning"><i class="fa fa-exclamation"></i>Please leave an answer before moving on.</p>');if(!found.length){if($(".lucid-warning").length==0){currentQuestion.parent(".questions").before($(questionWarningOption).fadeIn("slow"));return false;}else{$(".lucid-warning").fadeOut().fadeIn();return false;}}var values={};found.each(function(){if($(this).val()!==""){if(key==="value"){value=$(this).next(".answer").text();values[$(this).val()]=value;}else{if(key==="open"){values[key]=$(this).val();}}}else{if($(".lucid-warning").length==0){currentQuestion.parent(".questions").before($(questionWarningOpen).fadeIn("slow"));return false;}else{$(".lucid-warning").fadeOut().fadeIn();return false;}}});return Object.keys(values).length?values:false;};$.fn.updateReviewScreen=function(){if(!questionsReviewScreen.find("i").length){questionsReviewScreen.html('<div class="questions-loading-screen"><i class="fa fa-cog fa-spin fa-2x"></i></div>');}if($.isEmptyObject(questionsInAjax)){$.fn.updateReviewScreenAjax();}else{setTimeout(function(){$.fn.updateReviewScreen();},2000);}};$.fn.saveAnswer=function(callbackFunc){if(!questionsPagination.find(".current").next().length){return false;}var currentQuestionID=currentQuestion.attr("data-id");questionsInAjax[currentQuestionID]="processing";$.post(lucid_single_quiz_params.ajax_url,{action:"save_answer",security:lucid_single_quiz_params.save_answer_nonce,quizId:lucid_single_quiz_params.post_id,questionId:currentQuestion.attr("data-id"),answers:JSON.stringify(answers)},function(response){delete questionsInAjax[currentQuestionID];if(response){}if(callbackFunc&&(typeof callbackFunc=="function")){callbackFunc();}});return false;};$.fn.updateReviewScreenAjax=function(){$.post(lucid_single_quiz_params.ajax_url,{action:"update_review_screen",security:lucid_single_quiz_params.update_review_screen_nonce,quizId:lucid_single_quiz_params.post_id},function(response){if(response){questionsReviewScreen.fadeOut(600,function(){questionsReviewScreen.html(response).fadeIn(600);});}});return false;};$.fn.completeQuiz=function(){if(typeof timer!=="undefined"){timer.stop();}$.post(lucid_single_quiz_params.ajax_url,{action:"complete_quiz",security:lucid_single_quiz_params.complete_quiz_nonce,quizId:lucid_single_quiz_params.post_id},function(response){if(response){questionsLoadingScreen.fadeOut(600,function(){quizCompletedView.html(response);quizCompletedView.show().animate({opacity:1},600);});}});return false;};$(document).on("click",".show-quiz-results",function(){$(this).fadeOut(600,function(){quizCompletedView.show().animate({opacity:1},600);});});$(window).load(function(){if(questionsLoadingScreen.length){newQuestionID=$(".questions-pagination li a").last().parent().attr("data-id");$.fn.showQuestion();$(".questions-loading-screen i").fadeOut(600,function(){quizStartScreen.addClass("show").animate({opacity:1},600);});}});$(document).on("click",".start-quiz-screen button",function(e){e.preventDefault();questionsLoadingScreen.fadeOut(600,function(){quizStartScreen.removeClass("show");questionsContainer.fadeIn(600,function(){$.fn.initTimer();});});});$(document).on("click",".questions-pagination li a",function(e){e.preventDefault();if($(".lucid-warning").length!=0){$(".lucid-warning").fadeOut(500,function(){$(".lucid-warning").remove();});}newQuestionID=$(this).parent().attr("data-id");$.fn.animateQuestionsView(function(){$.fn.showQuestion();});});$(document).on("click",".questions-nav li button, .questions-nav li a",function(e){e.preventDefault();if(currentQuestion.attr("data-id")==="review"){return;}var direction=$(this).parent().attr("class");var element;if(direction=="next"){element=questionsPagination.find(".current").next();$.fn.validateAnswer();if(!element.find("a").length&&answers){var index=element.html();element.html('<a href="#">'+index+"</a>");}}else{if(direction=="prev"){element=questionsPagination.find(".current").prev();}}if(element.length&&(answers||direction=="prev")){newQuestionID=element.attr("data-id");if($(".lucid-warning").length!=0){$(".lucid-warning").fadeOut(500,function(){$(".lucid-warning").remove();});}$.fn.animateQuestionsView(function(){$.fn.showQuestion();});}});$(document).on("click",".complete-quiz",function(){$(".questions-loading-screen i").show();questionsContainer.fadeOut(600,function(){$.fn.completeQuiz();questionsLoadingScreen.fadeIn(600);});});});